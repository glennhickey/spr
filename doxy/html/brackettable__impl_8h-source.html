<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SPR: brackettable_impl.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>brackettable_impl.h</h1><a href="brackettable__impl_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _BUILDTABLE_IMPL_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _BUILDTABLE_IMPL_H</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include &lt;limits&gt;</span>
00005 <span class="preprocessor">#include "<a class="code" href="uptree_8h.html">uptree.h</a>"</span>
00006 
00007 
00008 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00009"></a><a class="code" href="classBracketTable.html#a0">00009</a> <a class="code" href="classBracketTable.html#a0">BracketTable&lt;T&gt;::BracketTable</a>() : _table(NULL), _tabSize(0)
00010 {
00011 }
00012 
00017 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00018"></a><a class="code" href="classBracketTable.html#a1">00018</a> <a class="code" href="classBracketTable.html#a0">BracketTable&lt;T&gt;::BracketTable</a>(<span class="keywordtype">int</span> size) : _tabSize(size)
00019 {
00020   <a class="code" href="classBracketTable.html#p1">_table</a> = (<a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>*)malloc(<a class="code" href="classBracketTable.html#p2">_tabSize</a> * <span class="keyword">sizeof</span>(<a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>));
00021   assert(<a class="code" href="classBracketTable.html#p2">_tabSize</a> &gt; 0);
00022 }
00023 
00024 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00025"></a><a class="code" href="classBracketTable.html#a2">00025</a> <a class="code" href="classBracketTable.html#a2">BracketTable&lt;T&gt;::~BracketTable</a>()
00026 {
00027   free(<a class="code" href="classBracketTable.html#p1">_table</a>);
00028 }
00029 
00034 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00035"></a><a class="code" href="classBracketTable.html#a3">00035</a> <span class="keywordtype">void</span> <a class="code" href="classBracketTable.html#a3">BracketTable&lt;T&gt;::resize</a>(<span class="keywordtype">int</span> size)
00036 {  
00037   <span class="keywordflow">if</span> (<a class="code" href="classBracketTable.html#p2">_tabSize</a> == 0)
00038   {
00039     <a class="code" href="classBracketTable.html#p1">_table</a> = (<a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>));
00040   }
00041   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &gt; <a class="code" href="classBracketTable.html#p2">_tabSize</a>)
00042   {
00043     <a class="code" href="classBracketTable.html#p1">_table</a> = (<a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>*)realloc(<a class="code" href="classBracketTable.html#p1">_table</a>, size * <span class="keyword">sizeof</span>(<a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>));   
00044   }
00045   <a class="code" href="classBracketTable.html#p2">_tabSize</a> = size;
00046   assert(<a class="code" href="classBracketTable.html#p2">_tabSize</a> &gt; 0);
00047 }
00048 
00052 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00053"></a><a class="code" href="classBracketTable.html#a4">00053</a> <span class="keywordtype">int</span> <a class="code" href="classBracketTable.html#a4">BracketTable&lt;T&gt;::getSize</a>()<span class="keyword"> const</span>
00054 <span class="keyword"></span>{
00055   <span class="keywordflow">return</span> <a class="code" href="classBracketTable.html#p2">_tabSize</a>;
00056 }
00057 
00062 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00063"></a><a class="code" href="classBracketTable.html#a8">00063</a> <span class="keyword">inline</span> <a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>&amp; <a class="code" href="classBracketTable.html#a8">BracketTable&lt;T&gt;::operator[]</a>(<span class="keywordtype">int</span> pos)
00064 {
00065   <span class="comment">// DEBUG</span>
00066   <span class="keywordflow">if</span> (pos &gt;= <a class="code" href="classBracketTable.html#p2">_tabSize</a>)
00067     assert(pos &lt; <a class="code" href="classBracketTable.html#p2">_tabSize</a>);
00068   <span class="keywordflow">return</span> <a class="code" href="classBracketTable.html#p1">_table</a>[pos];
00069 }
00070 
00076 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00077"></a><a class="code" href="classBracketTable.html#a9">00077</a> <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>&amp; <a class="code" href="classBracketTable.html#a8">BracketTable&lt;T&gt;::operator[]</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00078 <span class="keyword"></span>{
00079   assert(pos &lt; <a class="code" href="classBracketTable.html#p2">_tabSize</a>);
00080   <span class="keywordflow">return</span> <a class="code" href="classBracketTable.html#p1">_table</a>[pos];
00081 }
00082 
00088 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00089"></a><a class="code" href="classBracketTable.html#a10">00089</a> <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>&amp; <a class="code" href="classBracketTable.html#a10">BracketTable&lt;T&gt;::at</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00090 <span class="keyword"></span>{
00091   assert(pos &lt; <a class="code" href="classBracketTable.html#p2">_tabSize</a>);
00092   <span class="keywordflow">return</span> <a class="code" href="classBracketTable.html#p1">_table</a>[pos];
00093 }
00094 
00098 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00099"></a><a class="code" href="classBracketTable.html#a5">00099</a> <span class="keywordtype">int</span> <a class="code" href="classBracketTable.html#a5">BracketTable&lt;T&gt;::loadTree</a>(<span class="keyword">const</span> <a class="code" href="structUPTree.html">UPTree&lt;T&gt;</a>&amp; tree)
00100 {
00101   <span class="comment">// loadSubtree sets tripos</span>
00102   <span class="keywordtype">int</span> next = <a class="code" href="classBracketTable.html#a6">loadSubtree</a>(tree, 1, 0);
00103   next = <a class="code" href="classBracketTable.html#a6">loadSubtree</a>(tree, <a class="code" href="classBracketTable.html#p3">_triPos</a>[0] + next, 1);
00104   <a class="code" href="classBracketTable.html#a6">loadSubtree</a>(tree, <a class="code" href="classBracketTable.html#p3">_triPos</a>[1] + next, 2);
00105 
00106   <span class="comment">// TODO: return something more meaningful</span>
00107   <span class="keywordflow">return</span> 0;
00108 }
00109 
00113 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00114"></a><a class="code" href="classBracketTable.html#a7">00114</a> <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="structSubtreeRec.html">SubtreeRec&lt;T&gt;</a>* <a class="code" href="classBracketTable.html#a7">BracketTable&lt;T&gt;::getTable</a>()<span class="keyword"> const</span>
00115 <span class="keyword"></span>{
00116   <span class="keywordflow">return</span> <a class="code" href="classBracketTable.html#p1">_table</a>;
00117 }
00118  
00123 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00124"></a><a class="code" href="classBracketTable.html#a11">00124</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classBracketTable.html#a13">BracketTable&lt;T&gt;::getTriPos</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const </span>
00125 <span class="keyword"></span>{
00126   <span class="keywordflow">if</span> (pos &lt; <a class="code" href="classBracketTable.html#p3">_triPos</a>[1])
00127     <span class="keywordflow">return</span> 0;
00128   <span class="keywordflow">if</span> (pos &lt; <a class="code" href="classBracketTable.html#p3">_triPos</a>[2])
00129     <span class="keywordflow">return</span> 1;
00130   <span class="keywordflow">return</span> 2;
00131 }
00132 
00137 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00138"></a><a class="code" href="classBracketTable.html#a12">00138</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classBracketTable.html#a13">BracketTable&lt;T&gt;::getTriPos</a>(<span class="keywordtype">int</span> tripos[3])<span class="keyword"> const</span>
00139 <span class="keyword"></span>{
00140   memcpy(tripos, <a class="code" href="classBracketTable.html#p3">_triPos</a>, <span class="keyword">sizeof</span>(<a class="code" href="classBracketTable.html#p3">_triPos</a>));
00141 }
00142 
00147 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00148"></a><a class="code" href="classBracketTable.html#a13">00148</a> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">int</span>* <a class="code" href="classBracketTable.html#a13">BracketTable&lt;T&gt;::getTriPos</a>()<span class="keyword"> const</span>
00149 <span class="keyword"></span>{
00150   <span class="keywordflow">return</span> <a class="code" href="classBracketTable.html#p3">_triPos</a>;
00151 }
00152 
00159 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00160"></a><a class="code" href="classBracketTable.html#a6">00160</a> <span class="keywordtype">int</span> <a class="code" href="classBracketTable.html#a6">BracketTable&lt;T&gt;::loadSubtree</a>(<span class="keyword">const</span> <a class="code" href="structUPTree.html">UPTree&lt;T&gt;</a>&amp; tree, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> num)
00161 {
00162   assert(<a class="code" href="classBracketTable.html#p0">_stack</a>.empty());
00163   <span class="keywordtype">int</span> state;
00164   <span class="keywordtype">int</span> i = pos;
00165   T idx, mval;
00166   <a class="code" href="classBracketTable.html#p3">_triPos</a>[num] = pos;
00167 
00168   <span class="keywordflow">do</span> 
00169   {
00170     assert(i &lt; tree.size());
00171     
00172     <span class="comment">// left bracket: </span>
00173     <span class="keywordflow">if</span> (tree[i].myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00174     {
00175       <span class="comment">// update position of right subtree</span>
00176       <span class="keywordflow">if</span> (!<a class="code" href="classBracketTable.html#p0">_stack</a>.empty())
00177       {
00178         idx = <a class="code" href="classBracketTable.html#p0">_stack</a>.top();
00179         <span class="keywordflow">if</span> (i != <a class="code" href="classBracketTable.html#p1">_table</a>[idx].pos[0] + 1)
00180           <a class="code" href="classBracketTable.html#p1">_table</a>[idx].rPos = i;
00181       }
00182       <span class="comment">// create a new entry in the table.  </span>
00183       <a class="code" href="classBracketTable.html#p1">_table</a>[i].min[0] = std::numeric_limits&lt;T&gt;::max();
00184       <a class="code" href="classBracketTable.html#p1">_table</a>[i].min[1] = <a class="code" href="classBracketTable.html#p1">_table</a>[i].min[0];
00185       <a class="code" href="classBracketTable.html#p1">_table</a>[i].pos[0] = i;
00186       <a class="code" href="classBracketTable.html#p1">_table</a>[i].state = 0;
00187       <a class="code" href="classBracketTable.html#p0">_stack</a>.push(i);
00188     }
00189     <span class="comment">// right bracket</span>
00190     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tree[i].myType() == <a class="code" href="treetok_8h.html#a4a1">RB</a>) 
00191     {
00192       <span class="comment">// find minium of current subtree</span>
00193       idx = <a class="code" href="classBracketTable.html#p0">_stack</a>.top();
00194       <a class="code" href="classBracketTable.html#p1">_table</a>[idx].pos[1] = i;
00195       mval = std::min(<a class="code" href="classBracketTable.html#p1">_table</a>[idx].min[0], <a class="code" href="classBracketTable.html#p1">_table</a>[idx].min[1]);
00196       <span class="comment">// create new table entry</span>
00197       <a class="code" href="classBracketTable.html#p1">_table</a>[i] = <a class="code" href="classBracketTable.html#p1">_table</a>[idx];
00198       <span class="comment">// close it and updatedcontaining subtree</span>
00199       <a class="code" href="classBracketTable.html#p0">_stack</a>.pop();
00200       <span class="keywordflow">if</span> (!<a class="code" href="classBracketTable.html#p0">_stack</a>.empty())
00201       {
00202         idx = <a class="code" href="classBracketTable.html#p0">_stack</a>.top();
00203         state = <a class="code" href="classBracketTable.html#p1">_table</a>[idx].state;
00204         <a class="code" href="classBracketTable.html#p1">_table</a>[idx].min[state] = std::min(mval, <a class="code" href="classBracketTable.html#p1">_table</a>[idx].min[state]);
00205         <a class="code" href="classBracketTable.html#p1">_table</a>[idx].state = 1;
00206       }
00207     }
00208     <span class="comment">// leaf</span>
00209     <span class="keywordflow">else</span>
00210     {
00211       <span class="keywordflow">if</span> (i != pos)
00212       {
00213         <span class="comment">// update min value</span>
00214         idx = <a class="code" href="classBracketTable.html#p0">_stack</a>.top();
00215         state = <a class="code" href="classBracketTable.html#p1">_table</a>[idx].state;
00216         <a class="code" href="classBracketTable.html#p1">_table</a>[idx].min[state] = 
00217           std::min(tree[i].myLabel(), <a class="code" href="classBracketTable.html#p1">_table</a>[idx].min[state]);
00218         <a class="code" href="classBracketTable.html#p1">_table</a>[idx].state = 1;
00219         <span class="comment">// update position of right subtree</span>
00220         <a class="code" href="classBracketTable.html#p1">_table</a>[idx].rPos = i;
00221         <span class="comment">// add leaf entry to table</span>
00222       }
00223       <a class="code" href="classBracketTable.html#p1">_table</a>[i].pos[0] = <a class="code" href="classBracketTable.html#p1">_table</a>[i].pos[1] = <a class="code" href="classBracketTable.html#p1">_table</a>[i].rPos = i;
00224       <a class="code" href="classBracketTable.html#p1">_table</a>[i].min[0] = <a class="code" href="classBracketTable.html#p1">_table</a>[i].min[1] = tree[i].myLabel();
00225     }
00226     ++i;
00227   } <span class="keywordflow">while</span> (!<a class="code" href="classBracketTable.html#p0">_stack</a>.empty());
00228 
00229 
00230 <span class="comment">/*</span>
00231 <span class="comment">  // DEBUG</span>
00232 <span class="comment">  std:: cout &lt;&lt; "table validator" &lt;&lt;endl;</span>
00233 <span class="comment">  for (i = _table[pos].pos[0]; i &lt;= _table[pos].pos[1]; ++i)</span>
00234 <span class="comment">  {</span>
00235 <span class="comment">    if (tree[i].myType() != RB)</span>
00236 <span class="comment">    {</span>
00237 <span class="comment">      cout &lt;&lt; "i=" &lt;&lt; i &lt;&lt; ": lbpos = " &lt;&lt; _table[i].pos[0] </span>
00238 <span class="comment">           &lt;&lt; " rspos = " &lt;&lt; _table[i].rPos</span>
00239 <span class="comment">           &lt;&lt; " rbpos = " &lt;&lt; _table[i].pos[1]</span>
00240 <span class="comment">           &lt;&lt; " lmin = " &lt;&lt; _table[i].min[0]</span>
00241 <span class="comment">           &lt;&lt; " rmin = " &lt;&lt; _table[i].min[1] &lt;&lt; endl;</span>
00242 <span class="comment">    }</span>
00243 <span class="comment">  }</span>
00244 <span class="comment">*/</span>
00245   <span class="keywordflow">return</span> i - pos;
00246 }
00247 
00248 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Oct 2 18:43:17 2006 for SPR by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
