<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SPR: chaintable_impl.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>chaintable_impl.h</h1><a href="chaintable__impl_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _CHAINTABLE_IMPL_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _CHAINTABLE_IMPL_H</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include &lt;cmath&gt;</span>
00005 <span class="preprocessor">#include "<a class="code" href="uptree_8h.html">uptree.h</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="brackettable_8h.html">brackettable.h</a>"</span>
00007 
00008 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00009"></a><a class="code" href="classChainTable.html#a0">00009</a> <a class="code" href="classChainTable.html#a0">ChainTable&lt;T&gt;::ChainTable</a>() : _size(0), _ntable(NULL)
00010 {
00011 }
00012 
00016 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00017"></a><a class="code" href="classChainTable.html#a1">00017</a> <a class="code" href="classChainTable.html#a0">ChainTable&lt;T&gt;::ChainTable</a>(<span class="keywordtype">int</span> size) : _size(size)
00018 {
00019   <a class="code" href="classChainTable.html#p1">_ntable</a> = (<a class="code" href="structChainTable_1_1NList.html">NList</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code" href="structChainTable_1_1NList.html">NList</a>));
00020 }
00021 
00022 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00023"></a><a class="code" href="classChainTable.html#a2">00023</a> <a class="code" href="classChainTable.html#a2">ChainTable&lt;T&gt;::~ChainTable</a>()
00024 {
00025   free(<a class="code" href="classChainTable.html#p1">_ntable</a>);
00026 }
00027 
00031 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00032"></a><a class="code" href="classChainTable.html#a3">00032</a> <span class="keywordtype">void</span> <a class="code" href="classChainTable.html#a3">ChainTable&lt;T&gt;::resize</a>(<span class="keywordtype">int</span> size)
00033 {
00034   <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p0">_size</a> == 0)
00035   {
00036     <a class="code" href="classChainTable.html#p1">_ntable</a> = (<a class="code" href="structChainTable_1_1NList.html">NList</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code" href="structChainTable_1_1NList.html">NList</a>));
00037   }
00038   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &gt; <a class="code" href="classChainTable.html#p0">_size</a>)
00039   {
00040     <a class="code" href="classChainTable.html#p1">_ntable</a> = (<a class="code" href="structChainTable_1_1NList.html">NList</a>*)realloc(<a class="code" href="classChainTable.html#p1">_ntable</a>, 
00041                                          size * <span class="keyword">sizeof</span>(<a class="code" href="structChainTable_1_1NList.html">NList</a>));
00042   }
00043   <a class="code" href="classChainTable.html#p0">_size</a> = size;
00044 }
00045 
00049 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00050"></a><a class="code" href="classChainTable.html#a5">00050</a> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classChainTable.html">ChainTable&lt;T&gt;</a><a class="code" href="structChainTable_1_1NList.html">::NList</a>* <a class="code" href="classChainTable.html#a5">ChainTable&lt;T&gt;::getTable</a>()<span class="keyword"> const</span>
00051 <span class="keyword"></span>{
00052   <span class="keywordflow">return</span> <a class="code" href="classChainTable.html#p1">_ntable</a>;
00053 }
00054 
00061 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00062"></a><a class="code" href="classChainTable.html#a6">00062</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classChainTable.html#a6">ChainTable&lt;T&gt;::resetNeighbours</a>(<span class="keywordtype">int</span> pos, <span class="keyword">const</span> <a class="code" href="structChainTable_1_1NList.html">NList</a>&amp; neighbours)
00063 {
00064   <a class="code" href="classChainTable.html#p1">_ntable</a>[pos] = neighbours;
00065 }
00066 
00072 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00073"></a><a class="code" href="classChainTable.html#a7">00073</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classChainTable.html#a7">ChainTable&lt;T&gt;::removeNeighbours</a>(<span class="keywordtype">int</span> pos)
00074 {
00075   <a class="code" href="classChainTable.html#p1">_ntable</a>[pos].<a class="code" href="structChainTable_1_1NList.html#o0">_num</a> = 0;
00076 }
00077 
00083 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00084"></a><a class="code" href="classChainTable.html#a8">00084</a> <span class="keywordtype">void</span> <a class="code" href="classChainTable.html#a8">ChainTable&lt;T&gt;::removeFromNeighbours</a>(<span class="keywordtype">int</span> pos)
00085 {
00086   <span class="keywordtype">int</span> i, j, k;
00087   
00088   <span class="comment">// for each neighbour</span>
00089   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classChainTable.html#p1">_ntable</a>[pos]._num; ++i)
00090   {
00091     k = <a class="code" href="classChainTable.html#p1">_ntable</a>[pos].<a class="code" href="structChainTable_1_1NList.html#o1">_pos</a>[i];
00092     <span class="comment">// check each of neighbour's links</span>
00093     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="classChainTable.html#p1">_ntable</a>[k]._num; ++j)
00094     {
00095       <span class="comment">// if link links back to pos</span>
00096       <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p1">_ntable</a>[k]._pos[j] == pos)
00097       {
00098         <span class="comment">// remove it by swapping it with last and decrementing count</span>
00099         <a class="code" href="classChainTable.html#p1">_ntable</a>[k].<a class="code" href="structChainTable_1_1NList.html#o1">_pos</a>[j] = <a class="code" href="classChainTable.html#p1">_ntable</a>[k].<a class="code" href="structChainTable_1_1NList.html#o1">_pos</a>[--<a class="code" href="classChainTable.html#p1">_ntable</a>[k].<a class="code" href="structChainTable_1_1NList.html#o0">_num</a>];
00100         <span class="keywordflow">break</span>;
00101       }
00102     }
00103   }
00104 }
00105 
00109 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00110 <span class="keyword">inline</span> 
<a name="l00111"></a><a class="code" href="classChainTable.html#a9">00111</a> <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classChainTable.html">ChainTable&lt;T&gt;</a><a class="code" href="structChainTable_1_1NList.html">::NList</a>&amp; <a class="code" href="classChainTable.html#a9">ChainTable&lt;T&gt;::operator[]</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00112 <span class="keyword"></span>{
00113   <span class="keywordflow">return</span> <a class="code" href="classChainTable.html#p1">_ntable</a>[pos];
00114 }
00115 
00121 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00122"></a><a class="code" href="classChainTable.html#a4">00122</a> <span class="keywordtype">int</span> <a class="code" href="classChainTable.html#a4">ChainTable&lt;T&gt;::loadTree</a>(<span class="keyword">const</span> <a class="code" href="structUPTree.html">UPTree&lt;T&gt;</a>&amp; tree, <span class="keyword">const</span> <a class="code" href="classBracketTable.html">BracketTable&lt;T&gt;</a>&amp; 
00123                             btable)
00124 {
00125   <span class="keywordtype">int</span> i, j;
00126     
00127   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classChainTable.html#p0">_size</a>; ++i)
00128     <a class="code" href="classChainTable.html#p1">_ntable</a>[i].<a class="code" href="structChainTable_1_1NList.html#o0">_num</a> = 0;
00129 
00130   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classChainTable.html#p0">_size</a>; ++i)
00131   {
00132     <span class="keywordflow">if</span> (tree[i].myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00133     {
00134       <span class="comment">// this loop should only iterate a (very small) COSNTANT number of times,</span>
00135       <span class="comment">// keeping things O(n);</span>
00136       <span class="keywordflow">while</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size())
00137         <a class="code" href="classChainTable.html#p2">_stack</a>.pop();
00138       <span class="keywordflow">for</span> (j = i - 1; j &gt; 0; --j)
00139       {
00140         <span class="keywordflow">if</span> (tree[j].myType() == <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00141         {
00142           <a class="code" href="classChainTable.html#p2">_stack</a>.push(j);
00143           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() &gt; 1)
00144           {
00145             j = btable[j].pos[0];
00146             <a class="code" href="classChainTable.html#p2">_stack</a>.pop();
00147           }
00148         }
00149         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tree[j].myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00150         {
00151           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() &amp;&amp; tree[<a class="code" href="classChainTable.html#p2">_stack</a>.top()].myType() == <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00152             <a class="code" href="classChainTable.html#p2">_stack</a>.pop();
00153           <span class="keywordflow">else</span>
00154             <a class="code" href="classChainTable.html#p2">_stack</a>.push(j);
00155           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() &gt; 1)
00156             <span class="keywordflow">break</span>;
00157         }
00158         <span class="keywordflow">else</span>
00159         {
00160           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() == 1)
00161           {
00162             assert(<a class="code" href="classChainTable.html#p1">_ntable</a>[i]._num &lt; 4);
00163             <a class="code" href="classChainTable.html#p1">_ntable</a>[i].<a class="code" href="structChainTable_1_1NList.html#o1">_pos</a>[<a class="code" href="classChainTable.html#p1">_ntable</a>[i].<a class="code" href="structChainTable_1_1NList.html#o0">_num</a>++] = j;
00164           }
00165         }
00166       }
00167       
00168       <span class="comment">// this loop should only iterate a (very small) COSNTANT number of times,</span>
00169       <span class="comment">// keeping things O(n);</span>
00170       <span class="keywordflow">while</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size())
00171         <a class="code" href="classChainTable.html#p2">_stack</a>.pop();
00172       <span class="keywordflow">for</span> (j = i + 1; j &lt; <a class="code" href="classChainTable.html#p0">_size</a>; ++j)
00173       {
00174         <span class="keywordflow">if</span> (tree[j].myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00175         {
00176           <a class="code" href="classChainTable.html#p2">_stack</a>.push(j);
00177           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() &gt; 1)
00178           {
00179             j = btable[j].pos[1];
00180             <a class="code" href="classChainTable.html#p2">_stack</a>.pop();
00181           }
00182         }
00183         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tree[j].myType() == <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00184         {
00185           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() &amp;&amp; tree[<a class="code" href="classChainTable.html#p2">_stack</a>.top()].myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00186             <a class="code" href="classChainTable.html#p2">_stack</a>.pop();
00187           <span class="keywordflow">else</span>
00188             <a class="code" href="classChainTable.html#p2">_stack</a>.push(j);
00189           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() &gt; 1)
00190             <span class="keywordflow">break</span>;
00191         }
00192         <span class="keywordflow">else</span>
00193         {
00194           <span class="keywordflow">if</span> (<a class="code" href="classChainTable.html#p2">_stack</a>.size() == 1)
00195           {
00196             assert(<a class="code" href="classChainTable.html#p1">_ntable</a>[i]._num &lt; 4);
00197             <a class="code" href="classChainTable.html#p1">_ntable</a>[i].<a class="code" href="structChainTable_1_1NList.html#o1">_pos</a>[<a class="code" href="classChainTable.html#p1">_ntable</a>[i].<a class="code" href="structChainTable_1_1NList.html#o0">_num</a>++] = j;
00198           }
00199         }
00200       }
00201     }
00202   }
00203   <span class="keywordflow">return</span> 0;
00204 }
00205 
00206 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Oct 2 18:43:17 2006 for SPR by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
