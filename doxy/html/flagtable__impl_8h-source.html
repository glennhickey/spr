<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SPR: flagtable_impl.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>flagtable_impl.h</h1><a href="flagtable__impl_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _FLAGTABLE_IMPL_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _FLAGTABLE_IMPL_H</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include "<a class="code" href="uptree_8h.html">uptree.h</a>"</span>
00005 <span class="preprocessor">#include "<a class="code" href="brackettable_8h.html">brackettable.h</a>"</span>
00006 
00007 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00008"></a><a class="code" href="classFlagTable.html#a0">00008</a> <a class="code" href="classFlagTable.html#a0">FlagTable&lt;T&gt;::FlagTable</a>() : _size(0), _neis(NULL), _flags(NULL)
00009 {
00010 }
00011 
00015 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00016"></a><a class="code" href="classFlagTable.html#a1">00016</a> <a class="code" href="classFlagTable.html#a0">FlagTable&lt;T&gt;::FlagTable</a>(<span class="keywordtype">int</span> size) : _size(size)
00017 {
00018   <a class="code" href="classFlagTable.html#p1">_neis</a> = (<a class="code" href="structFlagTable_1_1Neighbours.html">Neighbours</a>*)malloc(<a class="code" href="classFlagTable.html#p0">_size</a> * <span class="keyword">sizeof</span>(<a class="code" href="structFlagTable_1_1Neighbours.html">Neighbours</a>));
00019   <a class="code" href="classFlagTable.html#p2">_flags</a> = (<a class="code" href="structFlagTable_1_1Flag.html">Flag</a>*)malloc(<a class="code" href="classFlagTable.html#p0">_size</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>));
00020 }
00021 
00022 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00023"></a><a class="code" href="classFlagTable.html#a2">00023</a> <a class="code" href="classFlagTable.html#a2">FlagTable&lt;T&gt;::~FlagTable</a>()
00024 {
00025   free(<a class="code" href="classFlagTable.html#p1">_neis</a>);
00026   free(<a class="code" href="classFlagTable.html#p2">_flags</a>);
00027 }
00028 
00032 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00033"></a><a class="code" href="classFlagTable.html#a3">00033</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a3">FlagTable&lt;T&gt;::resize</a>(<span class="keywordtype">int</span> size)
00034 {
00035   <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p0">_size</a> == 0)
00036   {
00037     <a class="code" href="classFlagTable.html#p1">_neis</a> = (<a class="code" href="structFlagTable_1_1Neighbours.html">Neighbours</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code" href="structFlagTable_1_1Neighbours.html">Neighbours</a>));
00038     <a class="code" href="classFlagTable.html#p2">_flags</a> = (<a class="code" href="structFlagTable_1_1Flag.html">Flag</a>*)malloc(size * <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>));
00039   }
00040   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &gt; <a class="code" href="classFlagTable.html#p0">_size</a>)
00041   {
00042     <a class="code" href="classFlagTable.html#p1">_neis</a> = (<a class="code" href="structFlagTable_1_1Neighbours.html">Neighbours</a>*)realloc(<a class="code" href="classFlagTable.html#p1">_neis</a>, size * <span class="keyword">sizeof</span>(<a class="code" href="structFlagTable_1_1Neighbours.html">Neighbours</a>));
00043     <a class="code" href="classFlagTable.html#p2">_flags</a> = (<a class="code" href="structFlagTable_1_1Flag.html">Flag</a>*)realloc(<a class="code" href="classFlagTable.html#p2">_flags</a>, size * <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>));
00044   }
00045   <a class="code" href="classFlagTable.html#p0">_size</a> = size;
00046 }
00047 
00052 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00053"></a><a class="code" href="classFlagTable.html#a4">00053</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a4">FlagTable&lt;T&gt;::setAll</a>(<span class="keywordtype">bool</span> del, <span class="keywordtype">bool</span> freeze)
00054 {
00055   <a class="code" href="structFlagTable_1_1Flag.html">Flag</a> val;
00056   val.<a class="code" href="structFlagTable_1_1Flag.html#o0">_del</a> = static_cast&lt;unsigned char&gt;(del);
00057   val.<a class="code" href="structFlagTable_1_1Flag.html#o1">_freeze</a> = static_cast&lt;unsigned char&gt;(freeze);
00058   memset(<a class="code" href="classFlagTable.html#p2">_flags</a>, val, <a class="code" href="classFlagTable.html#p0">_size</a>);
00059 }
00060 
00064 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00065"></a><a class="code" href="classFlagTable.html#a7">00065</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classFlagTable.html#a7">FlagTable&lt;T&gt;::leftPos</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00066 <span class="keyword"></span>{
00067   <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p1">_neis</a>[pos].<a class="code" href="structFlagTable_1_1Neighbours.html#o0">_left</a>;
00068 }
00069 
00073 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00074"></a><a class="code" href="classFlagTable.html#a8">00074</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classFlagTable.html#a8">FlagTable&lt;T&gt;::rightPos</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00075 <span class="keyword"></span>{
00076   <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p1">_neis</a>[pos].<a class="code" href="structFlagTable_1_1Neighbours.html#o1">_right</a>;
00077 }
00078 
00084 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00085"></a><a class="code" href="classFlagTable.html#a9">00085</a> <span class="keywordtype">int</span> <a class="code" href="classFlagTable.html#a9">FlagTable&lt;T&gt;::cherryPos</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00086 <span class="keyword"></span>{
00087   <span class="keywordflow">if</span> (pos == <a class="code" href="classFlagTable.html#p5">_triPos</a>[0])
00088   {
00089     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[1]).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00090       <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p5">_triPos</a>[1];
00091     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[2]).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00092       <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p5">_triPos</a>[2];
00093   }
00094   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos == <a class="code" href="classFlagTable.html#p5">_triPos</a>[1])
00095   {
00096     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[0]).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00097       <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p5">_triPos</a>[0];
00098     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[2]).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00099       <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p5">_triPos</a>[2];
00100   }
00101   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos == <a class="code" href="classFlagTable.html#p5">_triPos</a>[2])
00102   {
00103     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[0]).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00104       <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p5">_triPos</a>[0];
00105     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[1]).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00106       <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p5">_triPos</a>[1];
00107   }
00108   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#a7">leftPos</a>(pos)).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00109     <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#a7">leftPos</a>(pos);
00110   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#a8">rightPos</a>(pos)).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00111     <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#a8">rightPos</a>(pos);
00112 
00113   <span class="keywordflow">return</span> -1;
00114 }
00115 
00119 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00120"></a><a class="code" href="classFlagTable.html#a11">00120</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a11">FlagTable&lt;T&gt;::setFlag</a>(<span class="keywordtype">int</span> pos, <a class="code" href="structFlagTable_1_1Flag.html">Flag</a> val)
00121 {
00122   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos] = val;
00123   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o2">_rule</a> = <a class="code" href="classFlagTable.html#p6">_ruleState</a>;
00124 }
00125 
00129 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00130"></a><a class="code" href="classFlagTable.html#a12">00130</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a12">FlagTable&lt;T&gt;::setFrozen</a>(<span class="keywordtype">int</span> pos, <span class="keywordtype">bool</span> val)
00131 {
00132   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o1">_freeze</a> = static_cast&lt;unsigned char&gt;(val);
00133   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o2">_rule</a> = <a class="code" href="classFlagTable.html#p6">_ruleState</a>;
00134 }
00135 
00139 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00140"></a><a class="code" href="classFlagTable.html#a13">00140</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a13">FlagTable&lt;T&gt;::setDel</a>(<span class="keywordtype">int</span> pos, <span class="keywordtype">bool</span> val)
00141 {
00142   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o0">_del</a> = static_cast&lt;unsigned char&gt;(val);
00143   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o2">_rule</a> = <a class="code" href="classFlagTable.html#p6">_ruleState</a>;
00144 }
00145 
00149 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00150"></a><a class="code" href="classFlagTable.html#a14">00150</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classFlagTable.html#a14">FlagTable&lt;T&gt;::isFrozen</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00151 <span class="keyword"></span>{
00152   <span class="keywordflow">return</span> static_cast&lt;bool&gt;(<a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o1">_freeze</a>);
00153 }
00154 
00155 
00159 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00160"></a><a class="code" href="classFlagTable.html#a15">00160</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classFlagTable.html#a15">FlagTable&lt;T&gt;::isDel</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00161 <span class="keyword"></span>{
00162   <span class="keywordflow">return</span> static_cast&lt;bool&gt;(<a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o0">_del</a>);
00163 }
00164 
00168 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00169"></a><a class="code" href="classFlagTable.html#a16">00169</a> <span class="keyword">inline</span> <span class="keyword">typename</span> <a class="code" href="classFlagTable.html">FlagTable&lt;T&gt;</a><a class="code" href="structFlagTable_1_1Flag.html">::Flag</a> <a class="code" href="classFlagTable.html#a16">FlagTable&lt;T&gt;::flag</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00170 <span class="keyword"></span>{
00171   <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p2">_flags</a>[pos];
00172 }
00173 
00177 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00178"></a><a class="code" href="classFlagTable.html#a17">00178</a> <span class="keyword">inline</span> <span class="keyword">typename</span> <a class="code" href="classFlagTable.html">FlagTable&lt;T&gt;</a><a class="code" href="structFlagTable_1_1Flag.html">::Flag</a> <a class="code" href="classFlagTable.html#a17">FlagTable&lt;T&gt;::operator[]</a>(<span class="keywordtype">int</span> pos)<span class="keyword"> const</span>
00179 <span class="keyword"></span>{
00180   <span class="keywordflow">return</span> <a class="code" href="classFlagTable.html#p2">_flags</a>[pos];
00181 }
00182 
00186 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00187"></a><a class="code" href="classFlagTable.html#a18">00187</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a18">FlagTable&lt;T&gt;::nestPos</a>(<span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> nest[2])<span class="keyword"> const</span>
00188 <span class="keyword"></span>{
00189 
00190 }
00191 
00192 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00193"></a><a class="code" href="classFlagTable.html#a19">00193</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a19">FlagTable&lt;T&gt;::setRuleState</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rule)
00194 {
00195   assert(rule == 0 || rule == 1);
00196   <a class="code" href="classFlagTable.html#p6">_ruleState</a> = rule;
00197 }
00198 
00199 
00205 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00206"></a><a class="code" href="classFlagTable.html#a5">00206</a> <span class="keywordtype">int</span> <a class="code" href="classFlagTable.html#a5">FlagTable&lt;T&gt;::loadTree</a>(<span class="keyword">const</span> <a class="code" href="structUPTree.html">UPTree&lt;T&gt;</a>&amp; tree, <span class="keyword">const</span> <a class="code" href="classBracketTable.html">BracketTable&lt;T&gt;</a>&amp; 
00207                            btable)
00208 {
00209   assert(<a class="code" href="classFlagTable.html#p0">_size</a> == tree.size());
00210   <a class="code" href="classFlagTable.html#p3">_tree</a> = &amp;tree;
00211   <a class="code" href="classFlagTable.html#p4">_btable</a> = &amp;btable;
00212 
00213   <span class="keywordtype">int</span> last = <a class="code" href="classFlagTable.html#p0">_size</a> - 1;
00214 
00215   <a class="code" href="classFlagTable.html#p1">_neis</a>[0].<a class="code" href="structFlagTable_1_1Neighbours.html#o0">_left</a> = -1;
00216   <a class="code" href="classFlagTable.html#p1">_neis</a>[0].<a class="code" href="structFlagTable_1_1Neighbours.html#o1">_right</a> = 1;
00217   <a class="code" href="classFlagTable.html#p2">_flags</a>[0].<a class="code" href="structFlagTable_1_1Flag.html#o1">_freeze</a> = 0;
00218   <a class="code" href="classFlagTable.html#p2">_flags</a>[0].<a class="code" href="structFlagTable_1_1Flag.html#o0">_del</a> = 0;
00219   <a class="code" href="classFlagTable.html#p1">_neis</a>[last].<a class="code" href="structFlagTable_1_1Neighbours.html#o0">_left</a> = <a class="code" href="classFlagTable.html#p0">_size</a> - 2;
00220   <a class="code" href="classFlagTable.html#p1">_neis</a>[last].<a class="code" href="structFlagTable_1_1Neighbours.html#o1">_right</a> = -1;
00221   <a class="code" href="classFlagTable.html#p2">_flags</a>[last].<a class="code" href="structFlagTable_1_1Flag.html#o1">_freeze</a> = 0;
00222   <a class="code" href="classFlagTable.html#p2">_flags</a>[last].<a class="code" href="structFlagTable_1_1Flag.html#o0">_del</a> = 0;
00223 
00224   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; last; ++i)
00225   {
00226     <a class="code" href="classFlagTable.html#p1">_neis</a>[i].<a class="code" href="structFlagTable_1_1Neighbours.html#o0">_left</a> = i - 1;
00227     <a class="code" href="classFlagTable.html#p1">_neis</a>[i].<a class="code" href="structFlagTable_1_1Neighbours.html#o1">_right</a> = i + 1;
00228     <a class="code" href="classFlagTable.html#p2">_flags</a>[i].<a class="code" href="structFlagTable_1_1Flag.html#o1">_freeze</a> = 0;
00229     <a class="code" href="classFlagTable.html#p2">_flags</a>[i].<a class="code" href="structFlagTable_1_1Flag.html#o0">_del</a> = 0;
00230   }
00231   
00232   memcpy(<a class="code" href="classFlagTable.html#p5">_triPos</a>, btable.getTriPos(), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>[3]));
00233   
00234   <span class="keywordflow">return</span> 0;
00235 }
00236 
00243 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00244"></a><a class="code" href="classFlagTable.html#a6">00244</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a6">FlagTable&lt;T&gt;::copy</a>(<span class="keyword">const</span> <a class="code" href="classFlagTable.html">FlagTable&lt;T&gt;</a>&amp; ftable, <span class="keyword">const</span> <span class="keywordtype">int</span>* lookup)
00245 {
00246   assert(ftable._tree-&gt;size() == <a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;size());
00247   <a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a> tok;
00248   size_t state = <a class="code" href="classFlagTable.html#p6">_ruleState</a>;
00249   
00250   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _tree-&gt;size(); ++i)
00251   {
00252     tok = <a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](i);
00253     <span class="keywordflow">if</span> (tok.<a class="code" href="structTreeTok.html#a0">myType</a>() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>)
00254     {
00255       <span class="keywordflow">if</span> (ftable.isDel(lookup[tok.<a class="code" href="structTreeTok.html#a1">myLabel</a>()]) == <span class="keyword">true</span>)
00256       {
00257         <a class="code" href="classFlagTable.html#a19">setRuleState</a>(ftable._flags[lookup[tok.<a class="code" href="structTreeTok.html#a1">myLabel</a>()]]._rule);
00258         <a class="code" href="classFlagTable.html#a10">flagLeaf</a>(i);
00259       }
00260       <a class="code" href="classFlagTable.html#p2">_flags</a>[i] = ftable._flags[lookup[tok.<a class="code" href="structTreeTok.html#a1">myLabel</a>()]];
00261     }
00262   }
00263 
00264   <a class="code" href="classFlagTable.html#p6">_ruleState</a> = state;
00265 }
00266 
00276 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00277"></a><a class="code" href="classFlagTable.html#a10">00277</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a10">FlagTable&lt;T&gt;::flagLeaf</a>(<span class="keywordtype">int</span> pos)
00278 {
00279   assert(<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](pos).myType() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a>);
00280 
00281   <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(pos);
00282 
00283   <span class="keywordtype">int</span> i = -1;
00284   <span class="keywordtype">int</span> j = -1;
00285 
00286   <span class="comment">// if the leaf we are flagging corresponds to exactly a </span>
00287   <span class="comment">// trifurcation, it is a special case and we handle accordingly</span>
00288   <span class="comment">// by making sure that _tripos is kept up to date.</span>
00289   <span class="keywordflow">if</span> (pos == <a class="code" href="classFlagTable.html#p5">_triPos</a>[0])
00290   {
00291     i = 0;
00292     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[1]).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00293       j = 1;
00294     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[2]).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00295       j = 2;
00296   }
00297   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos == <a class="code" href="classFlagTable.html#p5">_triPos</a>[1])
00298   {
00299     i = 1;
00300     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[0]).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00301       j = 0;
00302     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[2]).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00303       j = 2;
00304   }
00305   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos == <a class="code" href="classFlagTable.html#p5">_triPos</a>[2])
00306   {
00307     i = 2;
00308     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[0]).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00309       j = 0;
00310     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](<a class="code" href="classFlagTable.html#p5">_triPos</a>[1]).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00311       j = 1;
00312   }
00313   <span class="keywordflow">if</span> (i &gt;= 0)
00314   {
00315     <span class="comment">// we want to remove tripos[i] and subdivide tripos[j] into two</span>
00316     assert(j &gt;= 0);
00317     <span class="keywordtype">int</span> t = <a class="code" href="classFlagTable.html#p5">_triPos</a>[j];
00318     <a class="code" href="classFlagTable.html#p5">_triPos</a>[i] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(<a class="code" href="classFlagTable.html#p5">_triPos</a>[j]);
00319     <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(t);
00320     <a class="code" href="classFlagTable.html#p5">_triPos</a>[j] = <a class="code" href="classFlagTable.html#a21">getRightPos</a>(<a class="code" href="classFlagTable.html#p5">_triPos</a>[j]);
00321     <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(<a class="code" href="classFlagTable.html#p4">_btable</a>-&gt;at(t).pos[1]);
00322 
00323     <span class="comment">// ensure tripos are in ascending order</span>
00324     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[1] &lt; <a class="code" href="classFlagTable.html#p5">_triPos</a>[0])
00325       std::swap(<a class="code" href="classFlagTable.html#p5">_triPos</a>[0], <a class="code" href="classFlagTable.html#p5">_triPos</a>[1]);
00326     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[2] &lt; <a class="code" href="classFlagTable.html#p5">_triPos</a>[1])
00327       std::swap(<a class="code" href="classFlagTable.html#p5">_triPos</a>[1], <a class="code" href="classFlagTable.html#p5">_triPos</a>[2]);
00328     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[1] &lt; <a class="code" href="classFlagTable.html#p5">_triPos</a>[0])
00329     std::swap(<a class="code" href="classFlagTable.html#p5">_triPos</a>[0], <a class="code" href="classFlagTable.html#p5">_triPos</a>[1]);
00330   }
00331 
00332   <span class="comment">// leaf is not a trifurcation, update the nesting brackets</span>
00333   <span class="keywordflow">else</span>
00334   {
00335     <span class="keywordtype">int</span> lpos = <a class="code" href="classFlagTable.html#a7">leftPos</a>(pos);
00336     <span class="keywordtype">int</span> rpos = <a class="code" href="classFlagTable.html#a8">rightPos</a>(pos);
00337 
00338     <span class="comment">// check left neighbour</span>
00339     <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](lpos).myType() == <a class="code" href="treetok_8h.html#a4a0">LB</a>)
00340     {
00341       <span class="comment">// update tripos if necessary</span>
00342       <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[0] == lpos)
00343         <a class="code" href="classFlagTable.html#p5">_triPos</a>[0] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(lpos);
00344       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[1] == lpos)
00345         <a class="code" href="classFlagTable.html#p5">_triPos</a>[1] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(lpos);
00346       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[2] == lpos)
00347         <a class="code" href="classFlagTable.html#p5">_triPos</a>[2] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(lpos);
00348 
00349       <span class="comment">//flag it and its matching right bracket</span>
00350       <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(lpos);
00351       <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(<a class="code" href="classFlagTable.html#p4">_btable</a>-&gt;operator[](lpos).pos[1]);
00352     }
00353     <span class="comment">// check right neighbour</span>
00354     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](rpos).myType() == <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00355     {
00356       lpos = <a class="code" href="classFlagTable.html#p4">_btable</a>-&gt;operator[](rpos).pos[0];
00357 
00358       <span class="comment">// update tripos if necessary</span>
00359       <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[0] == lpos)
00360         <a class="code" href="classFlagTable.html#p5">_triPos</a>[0] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(lpos);
00361       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[1] == lpos)
00362         <a class="code" href="classFlagTable.html#p5">_triPos</a>[1] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(lpos);
00363       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classFlagTable.html#p5">_triPos</a>[2] == lpos)
00364         <a class="code" href="classFlagTable.html#p5">_triPos</a>[2] = <a class="code" href="classFlagTable.html#a8">rightPos</a>(lpos);
00365 
00366       <span class="comment">//flag it and its matching left bracket</span>
00367       <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(rpos);
00368       <a class="code" href="classFlagTable.html#b0">flagUpdateNeighbours</a>(lpos);
00369     }
00370     <span class="keywordflow">else</span>
00371     {
00372       <span class="comment">//DEBUG</span>
00373       <span class="comment">//std::cout &lt;&lt; " pos = " &lt;&lt; pos &lt;&lt; " tripos = " &lt;&lt; _triPos[0] &lt;&lt; " "</span>
00374       <span class="comment">//          &lt;&lt; _triPos[1] &lt;&lt; " " &lt;&lt; _triPos[2] &lt;&lt; "\n";</span>
00375       assert(<span class="keyword">false</span>);
00376     }
00377   }
00378 }
00379 
00384 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00385"></a><a class="code" href="classFlagTable.html#b0">00385</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#b0">FlagTable&lt;T&gt;::flagUpdateNeighbours</a>(<span class="keywordtype">int</span> pos)
00386 {
00387   assert(<a class="code" href="classFlagTable.html#a15">isDel</a>(pos) == <span class="keyword">false</span>);
00388 
00389   <span class="comment">// flag the leaf</span>
00390   <a class="code" href="classFlagTable.html#a12">setFrozen</a>(pos, <span class="keyword">true</span>);
00391   <a class="code" href="classFlagTable.html#a13">setDel</a>(pos, <span class="keyword">true</span>);
00392   <a class="code" href="classFlagTable.html#p2">_flags</a>[pos].<a class="code" href="structFlagTable_1_1Flag.html#o2">_rule</a> = <a class="code" href="classFlagTable.html#p6">_ruleState</a>;
00393 
00394   <span class="comment">// update right neighbour of left neighbour</span>
00395   <span class="keywordflow">if</span> (pos &gt; 0)
00396   {
00397     <a class="code" href="classFlagTable.html#p1">_neis</a>[<a class="code" href="classFlagTable.html#a7">leftPos</a>(pos)].<a class="code" href="structFlagTable_1_1Neighbours.html#o1">_right</a> = <a class="code" href="classFlagTable.html#a8">rightPos</a>(pos);
00398     assert(<a class="code" href="classFlagTable.html#a15">isDel</a>(<a class="code" href="classFlagTable.html#p1">_neis</a>[<a class="code" href="classFlagTable.html#a7">leftPos</a>(pos)]._right) == <span class="keyword">false</span>);
00399   }
00400 
00401   <span class="comment">// update left neighbour of right neighbour</span>
00402   <span class="keywordflow">if</span> (pos &lt; <a class="code" href="classFlagTable.html#p0">_size</a> - 1)
00403   {
00404     <a class="code" href="classFlagTable.html#p1">_neis</a>[<a class="code" href="classFlagTable.html#a8">rightPos</a>(pos)].<a class="code" href="structFlagTable_1_1Neighbours.html#o0">_left</a> = <a class="code" href="classFlagTable.html#a7">leftPos</a>(pos);
00405     assert(<a class="code" href="classFlagTable.html#a15">isDel</a>(<a class="code" href="classFlagTable.html#p1">_neis</a>[<a class="code" href="classFlagTable.html#a8">rightPos</a>(pos)]._left) == <span class="keyword">false</span>);
00406   }
00407 
00408 }
00409 
00410 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00411"></a><a class="code" href="classFlagTable.html#a20">00411</a> <span class="keywordtype">void</span> <a class="code" href="classFlagTable.html#a20">FlagTable&lt;T&gt;::updateRekern</a>()
00412 {
00413   <span class="keywordtype">int</span> i;
00414   <a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a> tok;
00415   
00416   <span class="comment">// unfreeze outer brackets of subtrees flagged by rule 1.</span>
00417   <span class="comment">// even though these are to be deleted in a kernelization,</span>
00418   <span class="comment">// they can still be pruned and regrafted as a whole after a</span>
00419   <span class="comment">// REkernelization.</span>
00420   <span class="keywordflow">for</span> (i = 0; i &lt; _tree-&gt;size(); ++i)
00421   {
00422     tok = <a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](i);
00423     <span class="comment">// if it is a left bracket flagged by rule 1</span>
00424     <span class="keywordflow">if</span> (tok.<a class="code" href="structTreeTok.html#a0">myType</a>() == <a class="code" href="treetok_8h.html#a4a0">LB</a> &amp;&amp; <a class="code" href="classFlagTable.html#a15">isDel</a>(i) &amp;&amp; <a class="code" href="classFlagTable.html#p2">_flags</a>[i].<a class="code" href="structFlagTable_1_1Flag.html#o2">_rule</a> == 0)
00425     {
00426       <span class="comment">// remove the freeze flag</span>
00427       assert(<a class="code" href="classFlagTable.html#a14">isFrozen</a>(i));
00428       <a class="code" href="classFlagTable.html#a12">setFrozen</a>(i, <span class="keyword">false</span>);
00429       
00430       <span class="comment">// jump out of subtree</span>
00431       i = <a class="code" href="classFlagTable.html#p4">_btable</a>-&gt;at(i).pos[1] - 1;
00432     }
00433   }
00434 
00435   <span class="comment">// do the chains</span>
00436 }
00437 
00438 
00445 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00446"></a><a class="code" href="classFlagTable.html#a21">00446</a> <span class="keywordtype">int</span> <a class="code" href="classFlagTable.html#a21">FlagTable&lt;T&gt;::getRightPos</a>(<span class="keywordtype">int</span> pos)
00447 {
00448   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = pos + 1; ; ++i)
00449   {
00450     assert(i &lt; _btable-&gt;at(pos).pos[1]);
00451     <span class="keywordflow">if</span> (!<a class="code" href="classFlagTable.html#a15">isDel</a>(i) &amp;&amp; <a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](i).myType() != <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00452     {
00453       assert(i &lt; _btable-&gt;at(pos).pos[1]);
00454       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = <a class="code" href="classFlagTable.html#p4">_btable</a>-&gt;at(i).pos[1] + 1; ; ++j)
00455       {
00456         <span class="keywordflow">if</span> (!<a class="code" href="classFlagTable.html#a15">isDel</a>(j) &amp;&amp; <a class="code" href="classFlagTable.html#p3">_tree</a>-&gt;operator[](j).myType() != <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00457         {
00458           <span class="keywordflow">return</span> j;
00459         }
00460       }
00461       <span class="keywordflow">break</span>;
00462     }
00463   }
00464   <span class="comment">// there is no reason to ever reach this point</span>
00465   <span class="keywordflow">return</span> -1;
00466 }
00467 
00468 
00469 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00470"></a><a class="code" href="flagtable__impl_8h.html#a0">00470</a> std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const FlagTable&lt;T&gt;&amp; ftable)
00471 {
00472   <a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a> tok;
00473   <a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a> prev;
00474   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ftable._tree-&gt;size(); ++i)
00475   {
00476     tok = ftable._tree-&gt;operator[](i);
00477 
00478     <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; prev.<a class="code" href="structTreeTok.html#a0">myType</a>() != <a class="code" href="treetok_8h.html#a4a0">LB</a> &amp;&amp; tok.<a class="code" href="structTreeTok.html#a0">myType</a>() != <a class="code" href="treetok_8h.html#a4a1">RB</a>)
00479       os &lt;&lt; <span class="charliteral">','</span>;
00480     
00481     <span class="keywordflow">if</span> (ftable.isFrozen(i) &amp;&amp; ftable.isDel(i))
00482       os &lt;&lt; <span class="charliteral">'*'</span>;
00483     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ftable.isFrozen(i))
00484       os &lt;&lt; <span class="charliteral">'F'</span>;
00485     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ftable.isDel(i))
00486       os &lt;&lt; <span class="charliteral">'D'</span>;
00487     <span class="keywordflow">else</span>
00488       os &lt;&lt; (*ftable._tree)[i];
00489 
00490     <span class="keywordflow">if</span> ((ftable.isFrozen(i) || ftable.isDel(i)) &amp;&amp; 
00491         tok.<a class="code" href="structTreeTok.html#a0">myType</a>() == <a class="code" href="treetok_8h.html#a4a2">LEAF</a> &amp;&amp; tok.<a class="code" href="structTreeTok.html#a1">myLabel</a>() &gt; 9)
00492       os &lt;&lt; <span class="charliteral">'.'</span>;
00493 
00494     prev = tok;
00495   }
00496 
00497   <span class="keywordflow">return</span> os;
00498 }
00499 
00500 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Oct 2 18:43:18 2006 for SPR by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
