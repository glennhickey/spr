<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SPR: treemanager_impl.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>treemanager_impl.h</h1><a href="treemanager__impl_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _TREEMANAGER_IMPL_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _TREEMANAGER_IMPL_H</span>
00003 <span class="preprocessor"></span>
<a name="l00004"></a><a class="code" href="treemanager__impl_8h.html#a0">00004</a> <span class="preprocessor">#define DEF_START_SIZE 1024</span>
<a name="l00005"></a><a class="code" href="treemanager__impl_8h.html#a1">00005</a> <span class="preprocessor"></span><span class="preprocessor">#define DEF_TREE_SIZE 32</span>
<a name="l00006"></a><a class="code" href="treemanager__impl_8h.html#a2">00006</a> <span class="preprocessor"></span><span class="preprocessor">#define GROW_FACTOR 1.5</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#include "<a class="code" href="treetok_8h.html">treetok.h</a>"</span>
00009 <span class="preprocessor">#include "<a class="code" href="uptree_8h.html">uptree.h</a>"</span>
00010 
00015 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00016"></a><a class="code" href="classTreeManager.html#a0">00016</a> <a class="code" href="classTreeManager.html#d0">TreeManager&lt;T&gt;::TreeManager</a>(size_t numLeaves, size_t numTrees) : 
00017   _treeSize(numLeaves * 3 - 4), _size(0), _cap(numTrees)
00018 {
00019   <a class="code" href="classTreeManager.html#p0">_block</a> = (<a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a>*)malloc((<a class="code" href="classTreeManager.html#p3">_cap</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>) * <span class="keyword">sizeof</span>(T));
00020 }
00021 
00022 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00023"></a><a class="code" href="classTreeManager.html#a1">00023</a> <a class="code" href="classTreeManager.html#a1">TreeManager&lt;T&gt;::~TreeManager</a>()
00024 {
00025   free(<a class="code" href="classTreeManager.html#p0">_block</a>);
00026 }
00027 
00031 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00032"></a><a class="code" href="classTreeManager.html#a4">00032</a> <span class="keyword">inline</span> size_t <a class="code" href="classTreeManager.html#a4">TreeManager&lt;T&gt;::treeSize</a>()<span class="keyword"> const </span>
00033 <span class="keyword"></span>{
00034   <span class="keywordflow">return</span> <a class="code" href="classTreeManager.html#p1">_treeSize</a>;
00035 }
00036 
00040 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00041"></a><a class="code" href="classTreeManager.html#a5">00041</a> <span class="keyword">inline</span> size_t <a class="code" href="classTreeManager.html#a5">TreeManager&lt;T&gt;::numLeaves</a>()<span class="keyword"> const</span>
00042 <span class="keyword"></span>{
00043   <span class="keywordflow">return</span> (<a class="code" href="classTreeManager.html#p1">_treeSize</a> + 4) / 3;
00044 }
00045 
00049 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00050"></a><a class="code" href="classTreeManager.html#a6">00050</a> <span class="keyword">inline</span> size_t <a class="code" href="classTreeManager.html#a6">TreeManager&lt;T&gt;::size</a>()<span class="keyword"> const</span>
00051 <span class="keyword"></span>{
00052   <span class="keywordflow">return</span> <a class="code" href="classTreeManager.html#p2">_size</a>;
00053 }
00054 
00058 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00059"></a><a class="code" href="classTreeManager.html#a7">00059</a> <span class="keywordtype">void</span> <a class="code" href="classTreeManager.html#a7">TreeManager&lt;T&gt;::reset</a>()
00060 {
00061   <a class="code" href="classTreeManager.html#p2">_size</a> = 0;
00062 }
00063 
00067 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00068"></a><a class="code" href="classTreeManager.html#a2">00068</a> <span class="keyword">inline</span> <a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a> <a class="code" href="classTreeManager.html#a2">TreeManager&lt;T&gt;::operator[]</a>(size_t os)<span class="keyword"> const </span>
00069 <span class="keyword"></span>{
00070   assert(os &lt; <a class="code" href="classTreeManager.html#p2">_size</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>);
00071   assert(os &lt; <a class="code" href="classTreeManager.html#p3">_cap</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>);
00072   <span class="keywordflow">return</span> <a class="code" href="classTreeManager.html#p0">_block</a>[os];
00073 }
00074 
00078 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00079"></a><a class="code" href="classTreeManager.html#a3">00079</a> <span class="keyword">inline</span> <a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a>&amp; <a class="code" href="classTreeManager.html#a2">TreeManager&lt;T&gt;::operator[]</a>(size_t os)
00080 {
00081   assert(os &lt; <a class="code" href="classTreeManager.html#p2">_size</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>);
00082   assert(os &lt; <a class="code" href="classTreeManager.html#p3">_cap</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>);
00083   <span class="keywordflow">return</span> <a class="code" href="classTreeManager.html#p0">_block</a>[os];
00084 }
00085 
00091 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00092"></a><a class="code" href="classTreeManager.html#a8">00092</a> <span class="keywordtype">void</span> <a class="code" href="classTreeManager.html#a8">TreeManager&lt;T&gt;::createTree</a>(<a class="code" href="structUPTree.html">UPTree&lt;T&gt;</a>&amp; tree)
00093 {
00094   <span class="keywordflow">if</span> (<a class="code" href="classTreeManager.html#p2">_size</a> &gt;= <a class="code" href="classTreeManager.html#p3">_cap</a>)
00095   {
00096     <a class="code" href="classTreeManager.html#p3">_cap</a> = (size_t)(ceil(<a class="code" href="classTreeManager.html#p3">_cap</a> * <a class="code" href="treemanager__impl_8h.html#a2">GROW_FACTOR</a>));
00097     <a class="code" href="classTreeManager.html#p0">_block</a> = (<a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a>*)realloc(<a class="code" href="classTreeManager.html#p0">_block</a>, (<a class="code" href="classTreeManager.html#p3">_cap</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>) * <span class="keyword">sizeof</span>(T));
00098     <span class="keywordflow">if</span> (<a class="code" href="classTreeManager.html#p0">_block</a> == NULL)
00099     {
00100       std::cerr &lt;&lt; <span class="stringliteral">"Failed to alloc "</span> &lt;&lt; (<a class="code" href="classTreeManager.html#p3">_cap</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>) * <span class="keyword">sizeof</span>(T) &lt;&lt; endl;
00101       <a class="code" href="classTreeManager.html#p3">_cap</a> = 0;
00102       <a class="code" href="classTreeManager.html#p2">_size</a> = 0;
00103 
00104       <span class="keywordflow">throw</span> 0;
00105     }
00106     assert(<span class="keyword">sizeof</span>(<a class="code" href="structTreeTok.html">TreeTok&lt;T&gt;</a>) == <span class="keyword">sizeof</span>(T));
00107   }
00108 
00109   tree._os = <a class="code" href="classTreeManager.html#p2">_size</a> * <a class="code" href="classTreeManager.html#p1">_treeSize</a>;
00110   tree._man = <span class="keyword">this</span>;
00111   <a class="code" href="classTreeManager.html#p2">_size</a> += 1;
00112 }
00113 
00117 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00118"></a><a class="code" href="classTreeManager.html#a9">00118</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTreeManager.html#a9">TreeManager&lt;T&gt;::getTree</a>(size_t index, <a class="code" href="structUPTree.html">UPTree&lt;T&gt;</a>&amp; tree)
00119 {
00120   assert(indx &lt;= <a class="code" href="classTreeManager.html#p2">_size</a>);
00121   tree._os = index * <a class="code" href="classTreeManager.html#p1">_treeSize</a>;
00122   tree._man = <span class="keyword">this</span>;
00123 }
00124 
00129 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00130"></a><a class="code" href="classTreeManager.html#a10">00130</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTreeManager.html#a10">TreeManager&lt;T&gt;::deleteLast</a>()
00131 {
00132   assert(<a class="code" href="classTreeManager.html#p2">_size</a> &gt; 0);
00133   --<a class="code" href="classTreeManager.html#p2">_size</a>;
00134 }
00135 
00140 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00141"></a><a class="code" href="classTreeManager.html#a11">00141</a> <span class="keywordtype">bool</span> <a class="code" href="classTreeManager.html#a11">TreeManager&lt;T&gt;::compare</a>(size_t idx1, size_t idx2)
00142 {
00143   <span class="keywordflow">for</span> (size_t i = 0; i &lt; static_cast&lt;size_t&gt;(<a class="code" href="classTreeManager.html#p1">_treeSize</a>); ++i)
00144   {
00145     <span class="keywordflow">if</span> ( <a class="code" href="classTreeManager.html#p0">_block</a>[idx1 + i]._val != <a class="code" href="classTreeManager.html#p0">_block</a>[idx2 + i]._val)
00146     {
00147       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00148     }
00149   }
00150   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00151 }
00152 
00153 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Oct 2 18:43:18 2006 for SPR by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
